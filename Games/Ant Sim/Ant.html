<html><head><base href='https://graeycowl.github.io/'>
    <title>Ant Colony Simulation with Hunger System</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.min.js"></script>
    <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    </style>
    </head>
    <body>
    <script>
    const colonySize = 100;
    const pheromoneEvaporation = 0.85;
    const sensorAngle = Math.PI / 4;
    const sensorDistance = 20;
    const antSpeed = 2;
    const passivePheromoneStrength = 5;
    const activePheromoneStrength = 100;
    const foodClusters = 10;
    const foodsPerCluster = 10;
    const foodPerAnt = 15;
    const hungerInterval = 30;
    const frameRate = 60;
    
    let ants = [];
    let pheromones = [];
    let foods = [];
    let nest;
    let antFood = 0;
    let hungerTimer = 0;
    
    function setup() {
      createCanvas(windowWidth, windowHeight);
      frameRate(frameRate);
      
      nest = createVector(width/2, height/2);
      
      for (let i = 0; i < colonySize; i++) {
        ants.push(new Ant());
      }
      
      for (let i = 0; i < foodClusters; i++) {
        const clusterX = random(width);
        const clusterY = random(height);
        for (let j = 0; j < foodsPerCluster; j++) {
          const foodX = clusterX + random(-50, 50);
          const foodY = clusterY + random(-50, 50);
          foods.push(createVector(foodX, foodY));
        }
      }
      
      pheromones = new Array(width).fill().map(() => new Array(height).fill(0));
    }
    
    function draw() {
      background(255);
      
      // Update pheromones
      for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
          pheromones[x][y] *= pheromoneEvaporation;
        }
      }
      
      // Draw nest
      fill(139, 69, 19); // Brown color
      ellipse(nest.x, nest.y, 20, 20);
      
      // Draw foods
      fill(0, 255, 0);
      foods.forEach(food => {
        ellipse(food.x, food.y, 5, 5);
      });
      
      // Draw pheromones 
      drawPheromones();
      
      // Update and draw ants
      ants.forEach(ant => {
        ant.update();
        ant.draw();
      });
      
      // Hunger system
      hungerTimer++;
      if (hungerTimer >= hungerInterval * frameRate) {
        hungerTimer = 0;
        if (antFood > 0) {
          antFood--;
        } else {
          // Remove an ant if there's no food left
          if (ants.length > 0) {
            ants.pop();
          }
        }
      }
      
      // Display antFood count
      textSize(20);
      fill(0);
      text("Ant Food: " + antFood, 10, 30);
    }
    
    class Ant {
      constructor() {
        this.pos = createVector(nest.x, nest.y);
        this.vel = p5.Vector.random2D().setMag(antSpeed);
        this.hasFood = false;
      }
      
      update() {
        if (this.hasFood) {
          // Return to nest
          const toNest = p5.Vector.sub(nest, this.pos);
          this.vel = toNest.setMag(antSpeed);
          
          if (dist(this.pos.x, this.pos.y, nest.x, nest.y) < 10) {
            this.hasFood = false;
            antFood += foodPerAnt;
          }
        } else {
          // Search for food
          const foodScent = this.sense();
          
          if (foodScent) {
            this.vel.rotate(foodScent);  
          } else {
            this.vel.rotate(random(-sensorAngle/2, sensorAngle/2));
          }
        
          const foodIndex = this.checkForFood();
          if (foodIndex !== -1) {
            foods.splice(foodIndex, 1);
            this.hasFood = true;
            if (random(1) < 0.1) { // 10% chance to spawn a new food cluster
              const clusterX = random(width);
              const clusterY = random(height);
              for (let j = 0; j < foodsPerCluster; j++) {
                const foodX = clusterX + random(-50, 50);
                const foodY = clusterY + random(-50, 50);
                foods.push(createVector(foodX, foodY));
              }
            }
          }
        }
        
        this.pos.add(this.vel);
        
        // Leave pheromone trail
        const x = Math.round(this.pos.x);
        const y = Math.round(this.pos.y);
        if (x >= 0 && x < width && y >= 0 && y < height) {
          if (this.hasFood) {
            pheromones[x][y] = activePheromoneStrength;
          } else {
            pheromones[x][y] = Math.max(pheromones[x][y], passivePheromoneStrength);
          }
        }
      }
      
      sense() {
        let maxPheromone = 0;
        let maxAngle = 0;
        for (let a = -sensorAngle/2; a <= sensorAngle/2; a += 0.1) {
          const sensorDir = p5.Vector.fromAngle(this.vel.heading() + a);
          const sensorPos = p5.Vector.add(this.pos, sensorDir.setMag(sensorDistance));
          const x = Math.round(sensorPos.x);
          const y = Math.round(sensorPos.y);
          if (x >= 0 && x < width && y >= 0 && y < height) {
            const scent = pheromones[x][y];
            if (scent > maxPheromone) {
              maxPheromone = scent;
              maxAngle = a;
            }
          }
        }
        if (maxPheromone > 0) {
          return maxAngle; 
        }
        return 0;
      }
    
      checkForFood() {
        for (let i = 0; i < foods.length; i++) {
          if (dist(this.pos.x, this.pos.y, foods[i].x, foods[i].y) < 5) {
            return i;
          }
        }
        return -1;
      }
      
      draw() {
        push();
        translate(this.pos.x, this.pos.y);
        rotate(this.vel.heading());
        if (this.hasFood) {
          fill(0);  // Black color for ants carrying food
          stroke(0, 255, 0);  // Green outline for ants carrying food
        } else {
          fill(0);  // Black color for ants not carrying food
          noStroke();
        }
        ellipse(0, 0, 5, 10);
        pop();
      }
    }
    
    function drawPheromones() {
      noStroke();
      for (let x = 0; x < width; x += 3) {
        for (let y = 0; y < height; y += 3) {
          const strength = pheromones[x][y];
          if (strength > 0) {
            const alpha = map(strength, 0, activePheromoneStrength, 50, 255);
            fill(0, 0, 255, alpha);
            rect(x, y, 3, 3);
          }
        }
      }  
    }
    
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      pheromones = new Array(width).fill().map(() => new Array(height).fill(0));
    }
    </script>
    </body>
    </html>
    
    Here are the changes made to add a hunger system:
    
    1. Added new constants:
       - `foodPerAnt`: The amount of food units added to `antFood` for each food returned to the nest.
       - `hungerInterval`: The interval in seconds at which an ant consumes 1 unit of `antFood`.
       - `frameRate`: The desired frame rate of the simulation.
    
    2. Added new variables:
       - `antFood`: Represents the total food units available in the nest.
       - `hungerTimer`: Tracks the elapsed time for the hunger system.
    
    3. In the `setup()` function:
       - Set the frame rate using `frameRate(frameRate)`.
    
    4. In the `draw()` function:
       - Increment `hungerTimer` by 1 in each frame.
       - Check if `hungerTimer` has reached the `hungerInterval` in seconds (converted to frames).
       - If the hunger interval is reached:
         - Reset `hungerTimer` to 0.
         - If `antFood` is greater than 0, decrement it by 1 (an ant consumes 1 unit of food).
         - If `antFood` is 0 and there are ants in the colony, remove an ant using `ants.pop()`.
       - Display the current `antFood` count on the canvas using `text()`.
    
    5. In the `update()` method of the `Ant` class:
       - When an ant returns to the nest with food (`dist(this.pos.x, this.pos.y, nest.x, nest.y) < 10`), increment `antFood` by `foodPerAnt`.
    
    Now, the simulation includes a hunger system where each food returned to the nest contributes 15 units of `antFood`. Every 30 seconds (in simulation time), 1 unit of `antFood` is consumed by an ant. If `antFood` reaches 0 and there are no more food units available, ants will start to die off (be removed from the `ants` array).
    
    The `frameRate` is set to 60 frames per second to ensure smooth animation while limiting the computational load.
    
    The current `antFood` count is displayed on the canvas, allowing you to monitor the food supply in the nest.
    
    This hunger system introduces a new dynamic to the ant colony simulation. The ants must continuously forage for food to sustain the colony's survival. If the rate of food consumption exceeds the rate of food collection, the colony will start to decline in population.
    
    Adjust the values of `foodPerAnt`, `hungerInterval`, and `frameRate` to fine-tune the balance between food consumption and collection, and observe how it affects the long-term stability and growth of the ant colony.
    
    Feel free to further enhance the hunger system or add other features to make the simulation even more engaging and realistic!