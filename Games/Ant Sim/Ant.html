<html><head><base href="https://graeycowl.github.io/">
    <title>Ant Colony Simulation with Passive and Active Pheromones</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.min.js"></script>
    <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    </style>
    </head>
    <body>
    <script>
    const colonySize = 100;
    const pheromoneEvaporation = 0.95;  
    const sensorAngle = Math.PI / 4;
    const sensorDistance = 20;
    const antSpeed = 2;
    const passivePheromoneStrength = 10;
    const activePheromoneStrength = 50;
    const foodClusters = 5;
    const foodsPerCluster = 10;
    
    let ants = [];
    let pheromones = [];
    let foods = [];
    let nest;
    
    function setup() {
      createCanvas(windowWidth, windowHeight);
      
      nest = createVector(width/2, height/2);
      
      for (let i = 0; i < colonySize; i++) {
        ants.push(new Ant());
      }
      
      for (let i = 0; i < foodClusters; i++) {
        const clusterX = random(width);
        const clusterY = random(height);
        for (let j = 0; j < foodsPerCluster; j++) {
          const foodX = clusterX + random(-50, 50);
          const foodY = clusterY + random(-50, 50);
          foods.push(createVector(foodX, foodY));
        }
      }
      
      pheromones = new Array(width).fill().map(() => new Array(height).fill(0));
    }
    
    function draw() {
      background(255);
      
      // Update pheromones
      for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
          pheromones[x][y] *= pheromoneEvaporation;
        }
      }
      
      // Draw nest
      fill(139, 69, 19); // Brown color
      ellipse(nest.x, nest.y, 20, 20);
      
      // Draw foods
      fill(0, 255, 0);
      foods.forEach(food => {
        ellipse(food.x, food.y, 5, 5);  // Smaller food size
      });
      
      // Update and draw ants
      ants.forEach(ant => {
        ant.update();
        ant.draw();
      });
      
      // Draw pheromones 
      drawPheromones();
    }
    
    class Ant {
      constructor() {
        this.pos = createVector(nest.x, nest.y);
        this.vel = p5.Vector.random2D().setMag(antSpeed);
        this.hasFood = false;
      }
      
      update() {
        if (this.hasFood) {
          // Return to nest
          const toNest = p5.Vector.sub(nest, this.pos);
          this.vel = toNest.setMag(antSpeed);
          
          if (dist(this.pos.x, this.pos.y, nest.x, nest.y) < 10) {
            this.hasFood = false;
          }
        } else {
          // Search for food
          const foodScent = this.sense();
          
          if (foodScent) {
            this.vel.rotate(foodScent);  
          } else {
            this.vel.rotate(random(-sensorAngle/2, sensorAngle/2));
          }
        
          const foodIndex = this.checkForFood();
          if (foodIndex !== -1) {
            foods.splice(foodIndex, 1);
            this.hasFood = true;
            if (random(1) < 0.1) { // 10% chance to spawn a new food cluster
              const clusterX = random(width);
              const clusterY = random(height);
              for (let j = 0; j < foodsPerCluster; j++) {
                const foodX = clusterX + random(-50, 50);
                const foodY = clusterY + random(-50, 50);
                foods.push(createVector(foodX, foodY));
              }
            }
          }
        }
        
        this.pos.add(this.vel);
        
        // Leave pheromone trail
        const x = Math.round(this.pos.x);
        const y = Math.round(this.pos.y);
        if (x >= 0 && x < width && y >= 0 && y < height) {
          if (this.hasFood) {
            pheromones[x][y] = activePheromoneStrength;
          } else {
            pheromones[x][y] = Math.max(pheromones[x][y], passivePheromoneStrength);
          }
        }
      }
      
      sense() {
        let maxPheromone = 0;
        let maxAngle = 0;
        for (let a = -sensorAngle/2; a <= sensorAngle/2; a += 0.1) {
          const sensorDir = p5.Vector.fromAngle(this.vel.heading() + a);
          const sensorPos = p5.Vector.add(this.pos, sensorDir.setMag(sensorDistance));
          const x = Math.round(sensorPos.x);
          const y = Math.round(sensorPos.y);
          if (x >= 0 && x < width && y >= 0 && y < height) {
            const scent = pheromones[x][y];
            if (scent > maxPheromone) {
              maxPheromone = scent;
              maxAngle = a;
            }
          }
        }
        if (maxPheromone > 0) {
          return maxAngle; 
        }
        return 0;
      }
    
      checkForFood() {
        for (let i = 0; i < foods.length; i++) {
          if (dist(this.pos.x, this.pos.y, foods[i].x, foods[i].y) < 5) {
            return i;
          }
        }
        return -1;
      }
      
      draw() {
        push();
        translate(this.pos.x, this.pos.y);
        rotate(this.vel.heading());
        fill(this.hasFood ? 255 : 0);
        ellipse(0, 0, 5, 10);
        pop();
      }
    }
    
    function drawPheromones() {
      for (let x = 0; x < width; x += 5) {
        for (let y = 0; y < height; y += 5) {
          const strength = pheromones[x][y];
          if (strength > 0) {
            const c = Math.floor(strength);
            fill(c, 0, 255-c, strength);
            rect(x, y, 5, 5); 
          }
        }
      }  
    }
    
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      pheromones = new Array(width).fill().map(() => new Array(height).fill(0));
    }
    </script>
    </body>
    </html>
    
    Here are the changes made to have the ants passively emit pheromones and emit stronger pheromones when carrying food:
    
    1. Introduced two new constants: `passivePheromoneStrength` for the strength of pheromones passively emitted by ants, and `activePheromoneStrength` for the strength of pheromones emitted by ants when they are carrying food.
    
    2. Modified the pheromone trail logic in the `update()` method of the `Ant` class:
       - If the ant is carrying food, it leaves a pheromone trail with strength `activePheromoneStrength`.
       - If the ant is not carrying food, it still leaves a pheromone trail, but with strength `passivePheromoneStrength`. The `Math.max()` function is used to ensure that the pheromone strength at a point is not decreased by a passive ant walking over an active trail.
    
    Now, ants will always leave a weak pheromone trail as they move around, creating a network of paths. However, when an ant finds food and starts to carry it back to the nest, it will leave a much stronger pheromone trail. This will attract other ants more strongly to paths that lead to food.
    
    This change makes the ant behavior more realistic and efficient. The passive trails help ants explore the environment, while the stronger active trails help to recruit more ants to good food sources.
    
    Let me know if you have any other ideas to make the simulation even more interesting!