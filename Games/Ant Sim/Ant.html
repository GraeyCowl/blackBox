<html><head><base href="https://graeycowl.github.io/">
    <title>Ant Colony Simulation with Ants on Top and More Food</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.min.js"></script>
    <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
    </style>
    </head>
    <body>
    <script>
    const colonySize = 100;
    const pheromoneEvaporation = 0.85;
    const sensorAngle = Math.PI / 4;
    const sensorDistance = 20;
    const antSpeed = 2;
    const passivePheromoneStrength = 5;
    const activePheromoneStrength = 100;
    const foodClusters = 10;  // Increased food clusters
    const foodsPerCluster = 10;
    
    let ants = [];
    let pheromones = [];
    let foods = [];
    let nest;
    
    function setup() {
      createCanvas(windowWidth, windowHeight);
      
      nest = createVector(width/2, height/2);
      
      for (let i = 0; i < colonySize; i++) {
        ants.push(new Ant());
      }
      
      for (let i = 0; i < foodClusters; i++) {
        const clusterX = random(width);
        const clusterY = random(height);
        for (let j = 0; j < foodsPerCluster; j++) {
          const foodX = clusterX + random(-50, 50);
          const foodY = clusterY + random(-50, 50);
          foods.push(createVector(foodX, foodY));
        }
      }
      
      pheromones = new Array(width).fill().map(() => new Array(height).fill(0));
    }
    
    function draw() {
      background(255);
      
      // Update pheromones
      for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
          pheromones[x][y] *= pheromoneEvaporation;
        }
      }
      
      // Draw nest
      fill(139, 69, 19); // Brown color
      ellipse(nest.x, nest.y, 20, 20);
      
      // Draw foods
      fill(0, 255, 0);
      foods.forEach(food => {
        ellipse(food.x, food.y, 5, 5);
      });
      
      // Draw pheromones 
      drawPheromones();
      
      // Update and draw ants
      ants.forEach(ant => {
        ant.update();
        ant.draw();
      });
    }
    
    class Ant {
      constructor() {
        this.pos = createVector(nest.x, nest.y);
        this.vel = p5.Vector.random2D().setMag(antSpeed);
        this.hasFood = false;
      }
      
      update() {
        if (this.hasFood) {
          // Return to nest
          const toNest = p5.Vector.sub(nest, this.pos);
          this.vel = toNest.setMag(antSpeed);
          
          if (dist(this.pos.x, this.pos.y, nest.x, nest.y) < 10) {
            this.hasFood = false;
          }
        } else {
          // Search for food
          const foodScent = this.sense();
          
          if (foodScent) {
            this.vel.rotate(foodScent);  
          } else {
            this.vel.rotate(random(-sensorAngle/2, sensorAngle/2));
          }
        
          const foodIndex = this.checkForFood();
          if (foodIndex !== -1) {
            foods.splice(foodIndex, 1);
            this.hasFood = true;
            if (random(1) < 0.1) { // 10% chance to spawn a new food cluster
              const clusterX = random(width);
              const clusterY = random(height);
              for (let j = 0; j < foodsPerCluster; j++) {
                const foodX = clusterX + random(-50, 50);
                const foodY = clusterY + random(-50, 50);
                foods.push(createVector(foodX, foodY));
              }
            }
          }
        }
        
        this.pos.add(this.vel);
        
        // Leave pheromone trail
        const x = Math.round(this.pos.x);
        const y = Math.round(this.pos.y);
        if (x >= 0 && x < width && y >= 0 && y < height) {
          if (this.hasFood) {
            pheromones[x][y] = activePheromoneStrength;
          } else {
            pheromones[x][y] = Math.max(pheromones[x][y], passivePheromoneStrength);
          }
        }
      }
      
      sense() {
        let maxPheromone = 0;
        let maxAngle = 0;
        for (let a = -sensorAngle/2; a <= sensorAngle/2; a += 0.1) {
          const sensorDir = p5.Vector.fromAngle(this.vel.heading() + a);
          const sensorPos = p5.Vector.add(this.pos, sensorDir.setMag(sensorDistance));
          const x = Math.round(sensorPos.x);
          const y = Math.round(sensorPos.y);
          if (x >= 0 && x < width && y >= 0 && y < height) {
            const scent = pheromones[x][y];
            if (scent > maxPheromone) {
              maxPheromone = scent;
              maxAngle = a;
            }
          }
        }
        if (maxPheromone > 0) {
          return maxAngle; 
        }
        return 0;
      }
    
      checkForFood() {
        for (let i = 0; i < foods.length; i++) {
          if (dist(this.pos.x, this.pos.y, foods[i].x, foods[i].y) < 5) {
            return i;
          }
        }
        return -1;
      }
      
      draw() {
        push();
        translate(this.pos.x, this.pos.y);
        rotate(this.vel.heading());
        fill(this.hasFood ? 255 : 0);
        ellipse(0, 0, 5, 10);
        pop();
      }
    }
    
    function drawPheromones() {
      noStroke();
      for (let x = 0; x < width; x += 3) {
        for (let y = 0; y < height; y += 3) {
          const strength = pheromones[x][y];
          if (strength > 0) {
            const alpha = map(strength, 0, activePheromoneStrength, 50, 255);
            fill(0, 0, 255, alpha);
            rect(x, y, 3, 3);
          }
        }
      }  
    }
    
    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      pheromones = new Array(width).fill().map(() => new Array(height).fill(0));
    }
    </script>
    </body>
    </html>
    
    Here are the changes made to keep the ants on the top drawn layer and increase the number of food clusters:
    
    1. Changed the order of drawing in the `draw()` function:
       - The pheromones are now drawn before the ants.
       - This means that the ants will always be drawn on top of the pheromones and other elements, keeping them visible even when they are on top of the nest or food.
    
    2. Increased the value of `foodClusters` from 5 to 10:
       - This will double the number of food clusters that are initially spawned when the simulation starts.
       - With more food clusters, the ants will have more options to explore and exploit, leading to more complex foraging patterns.
    
    By drawing the ants after the pheromones, nest, and food, we ensure that the ants are always fully visible. They will no longer visually disappear when they are on top of other elements.
    
    Increasing the number of food clusters will provide the ants with a richer environment to navigate. With more food sources scattered around the canvas, the ants will have to make more decisions about which trails to follow and which sources to exploit. This can lead to the emergence of more complex collective behavior.
    
    Observe how the increased food availability affects the foraging patterns of the ant colony. You might see more branching and merging of trails as ants discover and communicate about the various food sources.
    
    Feel free to adjust the `foodClusters` value even further to see how the colony responds to different levels of resource abundance!